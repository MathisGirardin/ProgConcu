#PAS FINI
import random
import SharedArray as sa
import multiprocessing as mp 
from array import array
import time

def merge(tab, debut, milieu, fin):
    tableau = array('i', []) # tableau vide qui reçoit les résultats
    if debut > 0:
        tableau += tab[:debut]
    
    i1 = debut
    i2 = milieu
    
    while i1 != milieu and i2 != fin+1:
        if tab[i1] < tab[i2]:
            tableau.append(tab[i1])
            i1+=1
        else:
            tableau.append(tab[i2])
            i2+=1 
            
    if i1 != milieu:
        for i in range (i1, milieu) :
            tableau.append(tab[i])
    
    if i2 != fin+1:
        for i in range (i2, fin+1) :
            tableau.append(tab[i])
       
    tableau += tab[fin+1:]
    return tableau

def merge_sort(Tableau, debut, fin):
    length_Tableau = fin + 1 - debut
    if length_Tableau <= 1: return Tableau
    mid = length_Tableau // 2 + debut
    Tableau = merge_sort(Tableau, debut, mid -1)
    mp.Process(target=merge_sort,args=(Tableau, mid, fin)).start()
    Tableau = merge_sort(Tableau, mid, fin)
    return merge(Tableau, debut, mid, fin)

def version_de_base(N):
    Tab = array('i', [random.randint(0, 2 * N) for _ in range(N)])
    print("Avant : ", Tab)
    start = time.time()
    Tab = merge_sort(Tab, 0, len(Tab)-1)
    end = time.time()
    print("Après : ", Tab)
    print("Le temps avec 1 seul Process = %f pour un tableau de %d eles " %((end - start)*1000, N))
    
    print("Vérifions que le tri est correct --> ", end='')
    try :
        assert(all([(Tab[i] <= Tab[i+1]) for i in range(N-1)]))
        print("Le tri est OK !")
    except : print(" Le tri n’a pas marché !")
    
version_de_base(1000)

#TRACE
#Avant :  array('i', [1729, 466, 1376, 995, 1614, 1045, 1416, 218, 411, 1817, 1849, 1938, 359, 827, 499, 595, 1363, 1528, 388, 1162, 1878, 1881, 1015, 530, 1806, 340, 445, 1115, 1803, 385, 354, 1645, 584, 1221, 310, 1320, 494, 829, 983, 416, 475, 1533, 735, 533, 1011, 1892, 975, 103, 336, 1122, 431, 1286, 992, 267, 789, 1832, 1848, 7, 979, 1300, 1189, 779, 263, 267, 77, 636, 1457, 1682, 72, 1948, 561, 687, 1738, 733, 436, 760, 695, 560, 1901, 249, 535, 1257, 1374, 113, 1198, 871, 900, 1097, 1248, 833, 1972, 1307, 609, 847, 743, 1220, 1912, 1038, 1101, 415, 636, 1932, 823, 1196, 440, 1956, 346, 120, 632, 246, 208, 536, 1378, 1957, 1648, 838, 74, 955, 1684, 1809, 121, 876, 990, 708, 694, 782, 1593, 29, 409, 1796, 1434, 795, 355, 1471, 223, 269, 908, 44, 683, 1173, 1187, 1934, 1185, 1845, 1542, 1003, 1054, 1050, 1117, 883, 1951, 389, 1019, 752, 1763, 1680, 378, 18, 1046, 1015, 743, 1912, 752, 1879, 1133, 634, 1849, 1126, 1625, 136, 878, 1325, 1190, 537, 270, 1704, 1916, 1538, 949, 454, 567, 92, 1224, 1087, 1991, 1844, 1995, 113, 635, 872, 576, 1232, 1302, 768, 1493, 1261, 1501, 329, 1396, 554, 745, 87, 1305, 1622, 86, 1379, 664, 917, 1574, 1934, 926, 1459, 42, 1962, 597, 1490, 551, 913, 353, 1799, 1288, 454, 534, 1809, 768, 557, 1702, 319, 556, 68, 123, 635, 136, 829, 541, 1908, 1224, 1429, 1296, 716, 804, 46, 85, 1099, 291, 675, 1999, 1054, 1352, 768, 1363, 1165, 1707, 1150, 1189, 82, 406, 240, 81, 1064, 289, 1246, 848, 1116, 654, 152, 52, 542, 1211, 93, 264, 1128, 1355, 1180, 1998, 43, 1785, 163, 330, 607, 1372, 822, 677, 125, 1808, 1448, 655, 85, 1895, 1979, 481, 978, 59, 1952, 1161, 369, 1199, 1071, 46, 1023, 1817, 67, 1759, 942, 327, 1737, 1893, 1650, 1057, 1739, 1027, 374, 47, 1123, 960, 53, 211, 377, 1646, 700, 308, 734, 1615, 1416, 1966, 842, 201, 686, 1902, 469, 495, 94, 1792, 1230, 1796, 1756, 1203, 1595, 1343, 1603, 1498, 1080, 1558, 1239, 620, 1251, 358, 539, 1455, 1571, 1388, 715, 1395, 1841, 1933, 1308, 1082, 250, 1213, 1117, 720, 1043, 280, 1269, 390, 94, 933, 606, 1959, 1677, 33, 1528, 498, 1170, 1661, 662, 1350, 1582, 954, 1095, 1185, 1853, 1766, 1401, 141, 1977, 1458, 544, 601, 971, 980, 1072, 59, 64, 1145, 836, 1762, 439, 1312, 1104, 473, 234, 1748, 674, 963, 1147, 1179, 925, 143, 397, 1405, 40, 1618, 1305, 1643, 956, 1305, 499, 623, 1783, 973, 1277, 289, 1459, 165, 935, 1806, 934, 411, 1670, 1636, 1541, 1300, 1449, 512, 804, 663, 219, 1952, 1372, 1491, 1529, 1358, 556, 651, 1643, 1591, 314, 1042, 913, 113, 1772, 186, 816, 818, 1208, 1528, 1759, 1722, 1704, 1168, 1795, 635, 928, 51, 95, 1693, 1375, 369, 177, 1474, 21, 77, 1219, 58, 1746, 359, 900, 1749, 1413, 582, 682, 734, 1174, 503, 1358, 543, 1541, 1737, 1771, 265, 1895, 1538, 1538, 1434, 565, 1109, 725, 543, 410, 1264, 872, 238, 461, 1956, 922, 484, 393, 1109, 1997, 684, 215, 1445, 316, 1631, 645, 1390, 853, 1516, 839, 358, 11, 1064, 1328, 617, 282, 534, 1661, 516, 1795, 1083, 1656, 1253, 1117, 620, 748, 783, 732, 1393, 1238, 483, 1629, 927, 563, 516, 83, 1390, 151, 819, 1773, 820, 91, 421, 1831, 1802, 1188, 1853, 601, 67, 1097, 861, 1540, 1008, 1548, 394, 1571, 1738, 1514, 1827, 55, 1045, 27, 401, 408, 1905, 1615, 199, 54, 1355, 121, 1984, 1096, 278, 1094, 1049, 1426, 974, 1650, 1484, 14, 1229, 1233, 823, 1175, 495, 735, 889, 417, 1091, 1245, 646, 1359, 305, 1808, 1530, 537, 1299, 1428, 1938, 365, 344, 1768, 1435, 459, 1866, 968, 81, 567, 1969, 1644, 48, 1226, 1415, 83, 1969, 1189, 1849, 539, 201, 408, 270, 1879, 197, 1944, 920, 311, 1769, 1684, 1581, 506, 1226, 1497, 1337, 249, 1458, 519, 1249, 571, 909, 470, 871, 1034, 482, 132, 90, 308, 1824, 1, 486, 1865, 1205, 1459, 1213, 710, 624, 1444, 1026, 542, 279, 258, 546, 1745, 230, 1129, 727, 350, 1767, 463, 1839, 741, 1719, 1866, 1024, 223, 99, 109, 267, 1006, 387, 936, 1064, 109, 541, 259, 176, 43, 972, 1555, 1182, 1356, 1870, 1396, 970, 1996, 152, 263, 124, 1273, 13, 1026, 842, 160, 263, 1828, 274, 1140, 336, 130, 554, 817, 720, 788, 180, 1934, 1886, 1794, 938, 4, 1950, 1216, 54, 1223, 1244, 562, 1118, 1625, 1174, 131, 404, 165, 1107, 1831, 1124, 1710, 394, 1436, 1554, 1177, 1639, 967, 1004, 43, 6, 391, 0, 986, 279, 1375, 1872, 536, 244, 581, 1997, 1820, 912, 810, 1442, 1983, 801, 497, 1116, 751, 1225, 1464, 567, 1961, 1184, 1168, 1169, 933, 1145, 1948, 1099, 1876, 779, 67, 1832, 358, 164, 365, 1193, 1479, 228, 1830, 1472, 1328, 1675, 467, 1484, 1331, 943, 1025, 990, 1552, 1058, 962, 1698, 1870, 44, 994, 1058, 642, 1070, 743, 1511, 1974, 1120, 162, 305, 387, 1393, 1867, 1013, 1082, 1625, 1165, 574, 1293, 1696, 1764, 796, 295, 643, 1892, 1719, 125, 777, 1559, 273, 1164, 1684, 961, 1009, 578, 1218, 1225, 1287, 206, 948, 43, 348, 1385, 332, 26, 1781, 1741, 1090, 367, 1766, 444, 383, 357, 158, 1338, 1830, 1234, 777, 1748, 1646, 1943, 838, 968, 1487, 1076, 1352, 1774, 1876, 904, 981, 1138, 717, 333, 1966, 1159, 872, 1705, 1038, 1264, 1998, 382, 1058, 312, 808, 1190, 1347, 1913, 675, 1674, 1529, 387, 1412, 225, 910, 113, 1213, 901, 416, 953, 190, 497, 672, 256, 1574, 829, 1014, 1222, 1909, 904, 264, 1733, 1229, 365, 1954, 58, 1333, 568, 1661, 849, 448, 1417, 1886, 1927, 1519, 1917, 697, 498, 1111, 454, 673, 1609, 1524, 89, 862, 1612, 693, 423, 1033, 30, 937, 1338, 1630, 499, 62, 1956, 558, 682, 464, 1862, 358, 1779, 839, 73, 1150, 67, 313, 989, 150, 632, 1966, 699, 296, 1675, 1403, 1259, 1028, 1917, 1663, 693, 1584, 620, 1433, 1297, 1053, 1221, 656, 1841, 1046, 1757, 1400, 235, 949, 777, 1284, 9, 1517, 337, 837, 192, 500, 296])
#Après :  array('i', [0, 1, 4, 6, 7, 9, 11, 13, 14, 18, 21, 26, 27, 29, 30, 33, 40, 42, 43, 43, 43, 43, 44, 44, 46, 46, 47, 48, 51, 52, 53, 54, 54, 55, 58, 58, 59, 59, 62, 64, 67, 67, 67, 67, 68, 72, 73, 74, 77, 77, 81, 81, 82, 83, 83, 85, 85, 86, 87, 89, 90, 91, 92, 93, 94, 94, 95, 99, 103, 109, 109, 113, 113, 113, 113, 120, 121, 121, 123, 124, 125, 125, 130, 131, 132, 136, 136, 141, 143, 150, 151, 152, 152, 158, 160, 162, 163, 164, 165, 165, 176, 177, 180, 186, 190, 192, 197, 199, 201, 201, 206, 208, 211, 215, 218, 219, 223, 223, 225, 228, 230, 234, 235, 238, 240, 244, 246, 249, 249, 250, 256, 258, 259, 263, 263, 263, 264, 264, 265, 267, 267, 267, 269, 270, 270, 273, 274, 278, 279, 279, 280, 282, 289, 289, 291, 295, 296, 296, 305, 305, 308, 308, 310, 311, 312, 313, 314, 316, 319, 327, 329, 330, 332, 333, 336, 336, 337, 340, 344, 346, 348, 350, 353, 354, 355, 357, 358, 358, 358, 358, 359, 359, 365, 365, 365, 367, 369, 369, 374, 377, 378, 382, 383, 385, 387, 387, 387, 388, 389, 390, 391, 393, 394, 394, 397, 401, 404, 406, 408, 408, 409, 410, 411, 411, 415, 416, 416, 417, 421, 423, 431, 436, 439, 440, 444, 445, 448, 454, 454, 454, 459, 461, 463, 464, 466, 467, 469, 470, 473, 475, 481, 482, 483, 484, 486, 494, 495, 495, 497, 497, 498, 498, 499, 499, 499, 500, 503, 506, 512, 516, 516, 519, 530, 533, 534, 534, 535, 536, 536, 537, 537, 539, 539, 541, 541, 542, 542, 543, 543, 544, 546, 551, 554, 554, 556, 556, 557, 558, 560, 561, 562, 563, 565, 567, 567, 567, 568, 571, 574, 576, 578, 581, 582, 584, 595, 597, 601, 601, 606, 607, 609, 617, 620, 620, 620, 623, 624, 632, 632, 634, 635, 635, 635, 636, 636, 642, 643, 645, 646, 651, 654, 655, 656, 662, 663, 664, 672, 673, 674, 675, 675, 677, 682, 682, 683, 684, 686, 687, 693, 693, 694, 695, 697, 699, 700, 708, 710, 715, 716, 717, 720, 720, 725, 727, 732, 733, 734, 734, 735, 735, 741, 743, 743, 743, 745, 748, 751, 752, 752, 760, 768, 768, 768, 777, 777, 777, 779, 779, 782, 783, 788, 789, 795, 796, 801, 804, 804, 808, 810, 816, 817, 818, 819, 820, 822, 823, 823, 827, 829, 829, 829, 833, 836, 837, 838, 838, 839, 839, 842, 842, 847, 848, 849, 853, 861, 862, 871, 871, 872, 872, 872, 876, 878, 883, 889, 900, 900, 901, 904, 904, 908, 909, 910, 912, 913, 913, 917, 920, 922, 925, 926, 927, 928, 933, 933, 934, 935, 936, 937, 938, 942, 943, 948, 949, 949, 953, 954, 955, 956, 960, 961, 962, 963, 967, 968, 968, 970, 971, 972, 973, 974, 975, 978, 979, 980, 981, 983, 986, 989, 990, 990, 992, 994, 995, 1003, 1004, 1006, 1008, 1009, 1011, 1013, 1014, 1015, 1015, 1019, 1023, 1024, 1025, 1026, 1026, 1027, 1028, 1033, 1034, 1038, 1038, 1042, 1043, 1045, 1045, 1046, 1046, 1049, 1050, 1053, 1054, 1054, 1057, 1058, 1058, 1058, 1064, 1064, 1064, 1070, 1071, 1072, 1076, 1080, 1082, 1082, 1083, 1087, 1090, 1091, 1094, 1095, 1096, 1097, 1097, 1099, 1099, 1101, 1104, 1107, 1109, 1109, 1111, 1115, 1116, 1116, 1117, 1117, 1117, 1118, 1120, 1122, 1123, 1124, 1126, 1128, 1129, 1133, 1138, 1140, 1145, 1145, 1147, 1150, 1150, 1159, 1161, 1162, 1164, 1165, 1165, 1168, 1168, 1169, 1170, 1173, 1174, 1174, 1175, 1177, 1179, 1180, 1182, 1184, 1185, 1185, 1187, 1188, 1189, 1189, 1189, 1190, 1190, 1193, 1196, 1198, 1199, 1203, 1205, 1208, 1211, 1213, 1213, 1213, 1216, 1218, 1219, 1220, 1221, 1221, 1222, 1223, 1224, 1224, 1225, 1225, 1226, 1226, 1229, 1229, 1230, 1232, 1233, 1234, 1238, 1239, 1244, 1245, 1246, 1248, 1249, 1251, 1253, 1257, 1259, 1261, 1264, 1264, 1269, 1273, 1277, 1284, 1286, 1287, 1288, 1293, 1296, 1297, 1299, 1300, 1300, 1302, 1305, 1305, 1305, 1307, 1308, 1312, 1320, 1325, 1328, 1328, 1331, 1333, 1337, 1338, 1338, 1343, 1347, 1350, 1352, 1352, 1355, 1355, 1356, 1358, 1358, 1359, 1363, 1363, 1372, 1372, 1374, 1375, 1375, 1376, 1378, 1379, 1385, 1388, 1390, 1390, 1393, 1393, 1395, 1396, 1396, 1400, 1401, 1403, 1405, 1412, 1413, 1415, 1416, 1416, 1417, 1426, 1428, 1429, 1433, 1434, 1434, 1435, 1436, 1442, 1444, 1445, 1448, 1449, 1455, 1457, 1458, 1458, 1459, 1459, 1459, 1464, 1471, 1472, 1474, 1479, 1484, 1484, 1487, 1490, 1491, 1493, 1497, 1498, 1501, 1511, 1514, 1516, 1517, 1519, 1524, 1528, 1528, 1528, 1529, 1529, 1530, 1533, 1538, 1538, 1538, 1540, 1541, 1541, 1542, 1548, 1552, 1554, 1555, 1558, 1559, 1571, 1571, 1574, 1574, 1581, 1582, 1584, 1591, 1593, 1595, 1603, 1609, 1612, 1614, 1615, 1615, 1618, 1622, 1625, 1625, 1625, 1629, 1630, 1631, 1636, 1639, 1643, 1643, 1644, 1645, 1646, 1646, 1648, 1650, 1650, 1656, 1661, 1661, 1661, 1663, 1670, 1674, 1675, 1675, 1677, 1680, 1682, 1684, 1684, 1684, 1693, 1696, 1698, 1702, 1704, 1704, 1705, 1707, 1710, 1719, 1719, 1722, 1729, 1733, 1737, 1737, 1738, 1738, 1739, 1741, 1745, 1746, 1748, 1748, 1749, 1756, 1757, 1759, 1759, 1762, 1763, 1764, 1766, 1766, 1767, 1768, 1769, 1771, 1772, 1773, 1774, 1779, 1781, 1783, 1785, 1792, 1794, 1795, 1795, 1796, 1796, 1799, 1802, 1803, 1806, 1806, 1808, 1808, 1809, 1809, 1817, 1817, 1820, 1824, 1827, 1828, 1830, 1830, 1831, 1831, 1832, 1832, 1839, 1841, 1841, 1844, 1845, 1848, 1849, 1849, 1849, 1853, 1853, 1862, 1865, 1866, 1866, 1867, 1870, 1870, 1872, 1876, 1876, 1878, 1879, 1879, 1881, 1886, 1886, 1892, 1892, 1893, 1895, 1895, 1901, 1902, 1905, 1908, 1909, 1912, 1912, 1913, 1916, 1917, 1917, 1927, 1932, 1933, 1934, 1934, 1934, 1938, 1938, 1943, 1944, 1948, 1948, 1950, 1951, 1952, 1952, 1954, 1956, 1956, 1956, 1957, 1959, 1961, 1962, 1966, 1966, 1966, 1969, 1969, 1972, 1974, 1977, 1979, 1983, 1984, 1991, 1995, 1996, 1997, 1997, 1998, 1998, 1999])
#Le temps avec 1 seul Process = 3.773689 pour un tableau de 1000 eles 
#Vérifions que le tri est correct --> Le tri est OK !

